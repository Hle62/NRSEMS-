<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æº çŠ¯ç½ªé›»å“</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
        fieldset { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
        legend { font-weight: bold; padding: 0 10px; }
        #crime-list label { display: block; margin-bottom: 5px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 5px; }
        #result-display { margin-top: 20px; padding: 15px; border: 2px solid #333; font-size: 24px; font-weight: bold; background-color: #f9f9f9; }
        .alert { color: red; }
    </style>
</head>
<body>
    <h1>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æº çŠ¯ç½ªé›»å“</h1>

    <fieldset>
        <legend>ä»‹å…¥äººæ•°ã‚’é¸æŠ</legend>
        <label>
            <input type="radio" name="intervention" value="2_or_less" checked> 2äººä»¥ä¸‹
        </label>
        <label>
            <input type="radio" name="intervention" value="3_or_more"> 3äººä»¥ä¸Š
        </label>
    </fieldset>

    <h2>çŠ¯ç½ªåã®é¸æŠ (è¤‡æ•°é¸æŠå¯)</h2>
    
    <div id="crime-list">
        <label><input type="checkbox" name="crime" value="çªƒç›—"> çªƒç›—</label><br>
        <label><input type="checkbox" name="crime" value="å™¨ç‰©æå£Š"> å™¨ç‰©æå£Š</label><br>
        <label><input type="checkbox" name="crime" value="å‚·å®³"> å‚·å®³</label><br>
        <label><input type="checkbox" name="crime" value="æå–"> æå–</label><br>
        <label><input type="checkbox" name="crime" value="è©æ¬º"> è©æ¬º</label><br>
    </div>
    
    <button id="calculate-button">åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—</button>

    <div id="result-display">
        åˆè¨ˆé‡‘é¡: <span id="result-amount">0</span> å††
    </div>

    <script>
        // ğŸš¨ ã€æœ€é‡è¦ã€‘ã“ã“ã«ã‚ãªãŸã®GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ ğŸš¨
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyB7GM9D-Rr9_Sx9zYcnhEfdrZe3VaI1YndoFQuCz-xcwbe6r5rKvOeKs6lnp_4xwaUSg/exec';

        document.getElementById('calculate-button').addEventListener('click', async () => {
            const selectedCrimes = Array.from(document.querySelectorAll('input[name="crime"]:checked'))
                                        .map(cb => cb.value);
            const interventionType = document.querySelector('input[name="intervention"]:checked').value;
            const resultAmountSpan = document.getElementById('result-amount');

            resultAmountSpan.textContent = 'è¨ˆç®—ä¸­...';
            resultAmountSpan.classList.remove('alert');

            if (selectedCrimes.length === 0) {
                resultAmountSpan.textContent = '0';
                resultAmountSpan.classList.add('alert');
                alert('çŠ¯ç½ªåã‚’ä¸€ã¤ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            try {
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
                    },
                    // GASã®doPosté–¢æ•°ã¯JSONã§ã¯ãªãã€form dataå½¢å¼ã§å—ã‘å–ã‚‹ã“ã¨ãŒå¤šã„ãŸã‚ã€
                    // ã“ã“ã§ã¯bodyã®å†…å®¹ã‚’JSONæ–‡å­—åˆ—ã¨ã—ã¦æ¸¡ã—ã¾ã™ã€‚
                    body: JSON.stringify({
                        selected_crimes: selectedCrimes,
                        intervention_type: interventionType
                    })
                });

                if (!response.ok) {
                    throw new Error(`GAS Error: HTTP status ${response.status}`);
                }
                
                // GASã¯JSONã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¿”ã™ãŸã‚ã€text()ã§å—ã‘å–ã£ã¦ã‹ã‚‰æ‰‹å‹•ã§ãƒ‘ãƒ¼ã‚¹
                const text = await response.text();
                const data = JSON.parse(text);

                if (data.error) {
                     throw new Error(`GAS Script Error: ${data.error}`);
                }

                // çµæœã‚’è¡¨ç¤º
                resultAmountSpan.textContent = data.total_amount.toLocaleString();

            } catch (error) {
                console.error('è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                resultAmountSpan.textContent = 'ã‚¨ãƒ©ãƒ¼';
                resultAmountSpan.classList.add('alert');
                alert('è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨GASã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        });
    </script>
</body>
</html>